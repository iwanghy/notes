# 操作系统

- 计算机系统
  - 基本组成
    - 处理器
      - 发展
        - 多核心
        - 大容量缓存
        - 单指令多数据流
        - gpu/dsp
    - 内存（易失性）
    - I/O模块：外部环境交换数据
    - 系统总线
      - 提供处理器、主存、IO模块之间的通信
  - 指令的执行
    - 指令周期：取指、执行指令
    - 指令类型
      - 处理器-内存
      - 处理器-I/O
      - 数据处理
      - 控制
  - 中断
    - 中断类型
      - 程序中断
      - 时钟中断
      - IO中断
      - 硬件故障中断
    - 处理器可以在io执行过程中执行其他指令
    - 中断会在任何位置打断主程序
    - 指令周期中加入中断检测
      - 检测到中断后进入中断处理函数
    - 中断处理
      - 先硬件再软件
      - 硬件：完成当前指令、发送中断响应信号、PSW（进程状态字）和PC入栈、根据中断加载新的pc值、
      - 软件：保存其他进程状态信息（除了PC和PSW）、处理中断、恢复进程状态信息。
    - 多个中断
      - 禁止其他中断
        - 禁止中挂起该中断
      - 中断设置优先级：允许高优先级打断低优先级
  - 分级存储体系
    - 成本越来越低、容量越来越大
  - 高速缓存
    - 处理器和内存之间提供容量小、速度快的存储
    - 块传输·！！
    - 如果处理器需要读得地址RA不在高速缓存的内存块中，为其分配高速缓存槽，同时将内存块加载到缓存槽，并将RA的字传递给CPU
  - DMA
    - DMA控制流
      - 发送操作命令：读写操作、I/O设备地址、内存起始地址、数据长度。
      - DMA直接与存储器交互、完成后中断处理器
  - 多处理器和多核组织结构
    - 对称多处理器（SMP）
      - 共享内存和IO、内部总线互联
      - 所有处理器执行相同的功能
      - 由操作系统进行控制
      - 组织结构
        - 共享总线、通过存储器相互通信、可以交换信号
        - 更高级的缓存和L3之间的一致性问题；硬件来解决一致性问题
    - 多核（Multicore）
      - 分支主题
- 进程
  - 什么是进程
    - 一个正在执行的程序
    - 程序在计算机上运行的一个实例
    - 可以分配给处理器，并由处理器执行的一个实体
    - 一个由顺序执行的线程、一个当前状态和一组相关的系统资源所构成的单元
  - 什么是线程
    - 一个分配了资源的进程可以分解为多个并发的线程
  - 进程状态
    - 进程的创建和结束两个状态
    - 五状态模型
      - 运行态
      - 就绪态
      - 阻塞态/等待态
      - 新创建态
      - 结束态
  - 进程描述符
    - 操作系统管理四类资源
      - 内存
      - IO设备
      - 文件
      - 进程
    - 进程控制块
      - 管理和控制进程的数据结构
        - 进程标识符
          - 唯一数字标识，进程号
        - 处理器状态信息
        - 进程控制状态信息
  - 进程控制
    - 处理器执行的模式
      - 内核态
        - 处理器有一个处理器状态寄存器来表示特权级别
      - 用户态
    - 进程创建
      - 设置进程标识符
      - 为进程分配空间
      - 初始化进程控制块
      - 设置指针（PC）
      - 创建和扩充其他数据结构
    - 进程切换
      - 指控制权从当前程序转移到操作系统
      - 何时切换
        - 中断
        - 异常
        - 系统调用
          - 例如打开文件
          - 读写文件
          - 挂起
  - 并发：互斥与同步
  - 并发：死锁与饥饿
    - UNIX的并发控制机制
      - 管道
      - 消息
      - 共享内存
      - 信号灯
      - 信号
    - Linux内核的并发控制机制
      - 原子操作
      - 自旋锁
      - 信号灯
      - 屏障点
- 内存管理
  - 基本职责
    - 进程隔离
    - 自动分配和管理
    - 支持模块化编程
      - 动态创建和销毁
      - malloc free
    - 保护和访问控制
    - 永久存储
      - 持久化存储，关机后长时间保存信息
- 信息保护和安全
- 调度和资源管理
- Linux
  - 特点
    - 单体内核结构
    - 可加载内核
      - 动态链接加载内核模块
      - 可堆栈模块
  - 内核组件
    - 信号
    - 系统调用
    - 进程和调度器
    - 虚拟内存
    - 文件系统
    - 网络协议
    - 字符设备驱动
    - 快设备驱动
    - 网络设备驱动
    - 陷阱（trap）和错误（fault）
    - 物理内存
    - 中断